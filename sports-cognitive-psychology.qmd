# Sports and Cognitive Psychology {#sec-sportsCognitivePsychology}

## Load Packages {#sec-loadPackages}

```{r}
library("nflreadr")
library("tidyverse")
```

## Download Football Data {#sec-downloadFootballData}

```{r}
#| eval: false
#| include: false

library("here")

# Downloaded Data
load(file = here("data", "nfl_players.RData"))
load(file = here("data", "nfl_teams.RData"))
load(file = here("data", "nfl_rosters.RData"))
load(file = here("data", "nfl_rosters_weekly.RData"))
load(file = here("data", "nfl_schedules.RData"))
load(file = here("data", "nfl_combine.RData"))
load(file = here("data", "nfl_draftPicks.RData"))
load(file = here("data", "nfl_depthCharts.RData"))
load(file = file.path(path, "/OneDrive - University of Iowa/Teaching/Courses/Fantasy Football/Data/nfl_pbp.RData", fsep = ""))
load(file = file.path(path, "/OneDrive - University of Iowa/Teaching/Courses/Fantasy Football/Data/nfl_4thdown.RData", fsep = ""))
load(file = file.path(path, "/OneDrive - University of Iowa/Teaching/Courses/Fantasy Football/Data/nfl_participation.RData", fsep = ""))
load(file = here("data", "nfl_actualStats_weekly.RData"))
load(file = here("data", "nfl_injuries.RData"))
load(file = here("data", "nfl_snapCounts.RData"))
load(file = here("data", "nfl_espnQBR.RData"))
load(file = here("data", "nfl_nextGenStats_weekly.RData"))
load(file = here("data", "nfl_advancedStatsPFR.RData"))
load(file = here("data", "nfl_playerContracts.RData"))
load(file = here("data", "nfl_ftnCharting.RData"))
load(file = here("data", "nfl_playerIDs.RData"))
load(file = here("data", "nfl_rankings.RData"))
load(file = here("data", "nfl_expectedFantasyPoints_weekly.RData"))
load(file = here("data", "nfl_expectedFantasyPoints_offense.RData"))

# Calculated Data
load(file = here("data", "nfl_actualStats_career.RData"))
load(file = here("data", "nfl_actualStats_seasonal.RData"))
```

## Coaching and Risk Aversion {#sec-coachingRiskAversion}

```{r}
nfl_pbp4thDown <- nfl_pbp %>% 
  filter(down == 4) %>% 
  filter(!(play_type %in% c("no_play","qb_kneel")))

nfl_pbp4thDown$goForIt <- NA
nfl_pbp4thDown$goForIt[which(nfl_pbp4thDown$play_type %in% c("field_goal","punt"))] <- 0
nfl_pbp4thDown$goForIt[which(nfl_pbp4thDown$play_type %in% c("pass","run"))] <- 1

nfl_pbp4thDownPlotData <- nfl_pbp4thDown %>% 
  filter(!is.na(goForIt)) %>% 
  group_by(season) %>% 
  summarise(
    goForItPct = mean(goForIt, na.rm = TRUE),
    n = n(),
    sd = sd(goForIt),
    se = sd / n
  )

ggplot2::ggplot(
  data = nfl_pbp4thDownPlotData,
  ggplot2::aes(
    x = season,
    y = goForItPct)) +
  geom_point() +
  geom_line() +
  geom_ribbon(
    aes(
      y = goForItPct,
      ymin = goForItPct - qnorm(0.975)*se,
      ymax = goForItPct + qnorm(0.975)*se),
    alpha = 0.2) +
  scale_y_continuous(
    limits = c(0, NA)
  ) +
  ggplot2::labs(
    x = "Season",
    y = "Proportion of 4th Down Plays that are Attempts (to Get the First Down)",
    title = "4th Down Attempts (Proportion) by Season",
  ) +
  ggplot2::theme_classic()
```
